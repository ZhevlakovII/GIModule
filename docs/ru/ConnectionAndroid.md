# Подключение с Android

## Предисловие

На самом деле тут всё просто, так как я смог сделать адекватное переключение сервера (через чтение
файла). И в целом гайд можно закончить на том, что вам надо просто установить APK.

Для любознательных дальше будет гайд, как собрать всё самому.

## Навигация

1. [Получение APK для патча](#получение-apk-для-патча)
2. [Инструменты для патчинга](#инструменты-для-патчинга)
3. [Создание патча](#создания-патча)
    1. [Самостоятельное создание патча](#инструкция-для-самостоятельного-создания-патча)
        1. [Создание APK](#создание-apk)
        2. [Использование отладки](#использование-отладки)
4. [Патчинг](#патчинг)
5. [Запуск](#запуск)

### Получение APK для патча

Нам нужно получить исходный апк из этого лаунчера. Есть два способа:

1. Из этого репозитория, если будет возможность его загрузить
2. Скачать клиент Genshin Impact 4.0 (не знаю, где искать)
3. Скачиваете [лаунчер YuukiPS для Android](https://ps.yuuki.me/game/genshin-impact). Скачанный apk
   распаковываем как zip-архив и по пути assets/lspatch/modules/ будет исходный apk

### Инструменты для патчинга

Нашли? Отлично. Теперь нам надо сделать собственный патч. Для этого мы
скачиваем [LSPatch](https://github.com/LSPosed/LSPatch)
и [Shizuku](https://github.com/RikkaApps/Shizuku). Скачать их можно в разделе Releases. Скачали,
установили на смартфон (или сами собрали), круто.

### Создания патча

Есть два варианта создания патча:

1. Вы используете готовый патч
2. Создаёте патч сами

Отличие этих вариантов в том, что в первом варианте вы просто
скачиваете [патч](/docs/materials/apks/GIModule.apk) и переходите
к [Патчингу](#патчинг), а во втором собираете всё сами.

#### Инструкция для самостоятельного создания патча

Вы копируете текущий репозиторий к себе на компьютер, можно как архив, а можно и подтянуть
через GIT (для опытных). Скачали, распаковали и что нам дальше делать? Есть два варианта

1. Пытаемся собрать всё без Android Studio и используем сторонние гайды (не самый лучший вариант)
2. Просто скачиваем Android Studio (https://developer.android.com/studio), устанавливаем и открываем
   распакованный архив в ней

Дальнейшая инструкция для сборки через **Android Studio!**. Есть два варианта сборки:

1. Создание APK
2. Использование отладки через USB

##### Создание APK

Открываем меню Build, далее Build Bundle(s) / APK(s), далее Build APK(s)

![APK Build](/docs/materials/images/as_apk_build.png)

После сборки справа снизу возникнет такое уведомление. Нажимаем на locate и открывается папка с
нашим APK. Переносим его на телефон и устанавливаем

![APK Locate](/docs/materials/images/as_apk_locate.png)

##### Использование отладки

Второй вариант подразумевает то, что вы включили режим разработчика, разрешили отладку по USB и
подключили телефон к ПК. Для установки достаточно будет выбрать свой телефон и нажать Start (зеленый
треугольник)

![ADB Build](/docs/materials/images/as_adb_build.png)

### Патчинг

Нам необходимо установить подготовленный APK,
и [активировать Shizuku](https://doc.yuuki.me/docs/tutorial-patch/android).
Активировали, патчим LSPatch как Local, не Integrated (при Local вы можете быстро поменять патч).
Пропатчили, переустановили. Далее активируем наш модуль для патченой игры.

### Запуск

Итак, мы всё пропатчили и установили. Но так просто мы не сможем играть. Для выбора сервера есть
файл server.txt, который находится по пути Android/obb/**Название пакета, например com.yuuki.gi40cn
или com.miHoYo.GenshinImpact**.

Когда мы только установили патченный APK никакого файла не будет, он будет создан при первом заходе
в игру (но вы можете создать его сами).
Для чего это сделано? Чтобы вы могли скачать ресурсы игры с YuukiPS для 4.0 (пока не вышел
Grasscutter для 4.1), а после зайти на свой сервер.

Мы скачали ресурсы, далее находим файл и вписываем в него единственную строчку
формата http://127.0.0.1:2222 (если вы используете IP) или https://domain.com
http или https - не важно (это зависит от настроек вашего сервера), главное чтобы в файле была одна
строчка с вашим сервером, иначе вы будете заходить на YuukiPS.

После этих манипуляций вы сможете зайти на свой сервер.

**Поздравляю, вы можете играть по локальной сети!**

При необходимости, я могу расширить гайд подробным описанием установки Android Studio, LSPatch,
Shizuku, включением отладки и прочими штуками.